name: Discord Diag
on: { workflow_dispatch: {} }
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Post a simple message
        env:
          DISCORD_BOT_TOKEN: ${{ secrets.DISCORD_BOT_TOKEN }}
          DISCORD_CHANNEL_ID: ${{ secrets.DISCORD_CHANNEL_ID }}
        run: |
          python - <<'PY'
import os, json, urllib.request
t=os.environ["DISCORD_BOT_TOKEN"]; c=os.environ["DISCORD_CHANNEL_ID"].strip()
req=urllib.request.Request(
  f"https://discord.com/api/v10/channels/{c}/messages",
  data=json.dumps({"content":"✅ Discord Diag: hello from GitHub Actions"}).encode(),
  headers={"Authorization":f"Bot {t}","Content-Type":"application/json"},
  method="POST")
try:
  with urllib.request.urlopen(req) as r:
    print("HTTP", r.status, "OK")
except Exception as e:
  raise SystemExit(f"Discord error → {e}")
PY
